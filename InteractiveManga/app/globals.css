* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Helvetica Neue', Arial, 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', 'Meiryo', sans-serif; background: linear-gradient(135deg, #f0e6d2 0%, #e6d7c3 100%); min-height: 100vh; display: flex; justify-content: center; align-items: center; overflow-x: hidden; }

/* 本体 */
.book-container { position: relative; width: 1040px; height: 690px; perspective: 1500px; }
.spread { position: absolute; width: 100%; height: 100%; display: flex; opacity: 0; visibility: hidden; transition: opacity .5s, visibility .5s; }
.spread.active { opacity: 1; visibility: visible; }
.page { width: 520px; height: 690px; position: relative; background: #fffcf9; overflow: hidden; }
.page.left  { box-shadow: inset -10px 0 20px rgba(0,0,0,.1), -2px 0 5px rgba(0,0,0,.05); border-right: 1px solid rgba(0,0,0,.05); }
.page.right { box-shadow: inset 10px 0 20px rgba(0,0,0,.1),  2px 0 5px rgba(0,0,0,.05); border-left:  1px solid rgba(0,0,0,.05); }
.spread::after { content: ''; position: absolute; left: 50%; top: 0; width: 20px; height: 100%; transform: translateX(-50%); background: linear-gradient(to right, transparent, rgba(0,0,0,.2) 30%, rgba(0,0,0,.3) 50%, rgba(0,0,0,.2) 70%, transparent); pointer-events: none; z-index: 10; }
.page.empty { background: transparent; box-shadow: none; border: none; }

/* 共通 */
.manga-page { width: 100%; height: 100%; border: 3px solid #000; background: #fff; padding: 20px; position: relative; }
.page-number { position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%); font-size: 14px; color: #666; font-weight: 500; background: #fff; padding: 2px 8px; border-radius: 10px; }
.koma { position: relative; border: 3px solid #000; overflow: hidden; background: #fafafa; }
.koma img.koma-img-el { position:absolute; inset:0; width:100%; height:100%; object-fit: cover; display:block; }
.asset-badge { position: absolute; right: 8px; bottom: 8px; z-index: 4; background: rgba(0,0,0,.75); color:#fff; padding: 2px 8px; border-radius: 10px; font-size: 12px; font-weight: 600; letter-spacing: .02em; }

/* Cover styling */
.cover-container { width: 100%; height: 100%; position: relative; display: flex; align-items: center; justify-content: center; background: #fff; }
.cover-image { width: 100%; height: 100%; object-fit: cover; display: none; }
.cover-container.has-image .cover-placeholder { display: none; }
.cover-placeholder { font-size: 24px; color: #999; }

/* Front inside page */
.front-inside { width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; }
.qr-code-area { width: 200px; height: 200px; background: #f0f0f0; border: 2px dashed #ccc; }

/* ===== ページ1（上2スクエア＋下全面） ===== */
.layout-p1v2 { height: 100%; display: flex; flex-direction: column; gap: 15px; }
.layout-p1v2 .row.top { display: flex; gap: 15px; }
.layout-p1v2 .row.top .koma { flex: 1 1 0; aspect-ratio: 1 / 1; }
.layout-p1v2 .row.bottom { flex: 1 1 0; min-height: 0; }
.layout-p1v2 .row.bottom .koma { height: 100%; }

/* ===== ページ2（添付レイアウト） ===== */
.layout-p2v2 { height: 100%; display: flex; flex-direction: column; gap: 12px; }
.layout-p2v2 .row { display: flex; gap: 12px; }
.layout-p2v2 .row.top { flex: 1.5 1 0; }
.layout-p2v2 .row.top .koma { flex: 1 1 0; height: 100%; }
.layout-p2v2 .row.mid { flex: 1 1 0; }
.layout-p2v2 .row.mid .left   { flex: 2.2 1 0; }
.layout-p2v2 .row.mid .thin   { flex: 0.55 1 0; }
.layout-p2v2 .row.mid .right  { flex: 1.25 1 0; }
.layout-p2v2 .row.mid .koma   { height: 100%; }
.layout-p2v2 .row.bottom { flex: 0.8 1 0; }
.layout-p2v2 .row.bottom .koma { flex: 1 1 0; height: 100%; }

/* ===== ページ3（横2段：上1・下1） ===== */
.layout-p3v2 { height: 100%; display: flex; flex-direction: column; gap: 14px; }
.layout-p3v2 .row { display: flex; min-height: 0; }
.layout-p3v2 .row.top { flex: 3.5 1 0; }
.layout-p3v2 .row.bottom { flex: 1.5 1 0; }
.layout-p3v2 .koma { flex: 1 1 0; height: 100%; }

/* ===== ページ4（ページ全体 2列×3行・右#5は2行スパン） ===== */
.layout-p4v2 { --g: 16px; height: 100%; display: grid; grid-template-columns: 1fr 1fr; grid-template-rows: repeat(3, 1fr); gap: var(--g); }
.layout-p4v2 .k1 { grid-area: 1 / 1 / 2 / 2; }
.layout-p4v2 .k2 { grid-area: 1 / 2 / 2 / 3; }
.layout-p4v2 .k3 { grid-area: 2 / 1 / 3 / 2; }
.layout-p4v2 .k4 { grid-area: 3 / 1 / 4 / 2; }
.layout-p4v2 .k5 { grid-area: 2 / 2 / 4 / 3; min-height: 0; }
.layout-p4v2 .koma { height: 100%; }

/* ===== ページ5（上2× 下2× ＋ 最下段ワイド1） ===== */
.layout-p5 { height: 100%; display: flex; flex-direction: column; gap: 14px; }
.layout-p5 .row { display: flex; gap: 14px; min-height: 0; }
.layout-p5 .row.top { flex: 1 1 0; }
.layout-p5 .row.mid { flex: 1 1 0; }
.layout-p5 .row.top .koma, .layout-p5 .row.mid .koma { flex: 1 1 0; aspect-ratio: 1 / 1; }
.layout-p5 .row.bottom { flex: 1 1 0; }
.layout-p5 .row.bottom .koma { height: 100%; flex: 1 1 0; }

/* ===== ページ6（上3スクエア／中段ワイド1／下2スクエア） ===== */
.layout-p6 { --g: 16px; height: 100%; display: flex; flex-direction: column; gap: var(--g); }
.layout-p6 .row { display: flex; gap: var(--g); min-height: 0; }
.layout-p6 .row.top .koma { flex: 1 1 0; aspect-ratio: 1 / 1; }
.layout-p6 .row.mid { flex: 1 1 0; }
.layout-p6 .row.mid .koma { flex: 1 1 0; height: 100%; }
.layout-p6 .row.bottom .koma { flex: 1 1 0; aspect-ratio: 1 / 1; }

/* ===== ページ7（上：左ワイド＋右スクエア／中：フルワイド／下：2スクエア） ===== */
.layout-p7 { --g: 16px; height: 100%; display: flex; flex-direction: column; gap: var(--g); }
.layout-p7 .row { display: flex; gap: var(--g); min-height: 0; }
.layout-p7 .row.top { flex: 0 0 auto; }
.layout-p7 .row.top .left  { flex: 2 1 0; aspect-ratio: 16 / 10; }
.layout-p7 .row.top .right { flex: 1 1 0; aspect-ratio: 1 / 1; }
.layout-p7 .row.mid { flex: 1 1 0; }
.layout-p7 .row.mid .koma { flex: 1 1 0; height: 100%; }
.layout-p7 .row.bottom { flex: 0 0 auto; }
.layout-p7 .row.bottom .koma { flex: 1 1 0; aspect-ratio: 1 / 1; }

/* ===== ページ7（上：左縦／右横広、中央：2枚＝等幅、下：フルワイド）===== */
.layout-p7b { --g: 16px; height: 100%; display: flex; flex-direction: column; gap: var(--g); }
.layout-p7b .row { display: grid; gap: var(--g); min-height: 0; }
.layout-p7b .row.top { grid-template-columns: 1fr 2fr; flex: 1 1 0; }
.layout-p7b .row.mid { grid-template-columns: 1fr 1fr; flex: 1 1 0; }
.layout-p7b .row.bottom { flex: 1.4 1 0; }
.layout-p7b .row .koma { height: 100%; }

/* --- ページ8の微調整: mid を少し高く、bottom を少し低く --- */
[data-page="8"].layout-p7 .row.bottom .koma { aspect-ratio: 11 / 10; }

/* ===== ページ9（上：2スクエア／中：左細・右ワイド／下：2スクエア） ===== */
.layout-p9 { --g: 16px; height: 100%; display: flex; flex-direction: column; gap: var(--g); }
.layout-p9 .row { display: grid; gap: var(--g); min-height: 0; }
.layout-p9 .row.top    { grid-template-columns: 1fr 1fr; }
.layout-p9 .row.top .koma, .layout-p9 .row.bottom .koma { aspect-ratio: 1 / 1; }
.layout-p9 .row.mid    { grid-template-columns: 1fr 2fr; flex: 1 1 0; }
.layout-p9 .row.mid .koma { height: 100%; }
.layout-p9 .row.bottom { grid-template-columns: 1fr 1fr; }

/* --- ページ9の微調整: 中段を少し高く、下段を少し低く --- */
[data-page="9"].layout-p9 .row.mid { flex: 1.3 1 0; }
[data-page="9"].layout-p9 .row.bottom .koma { aspect-ratio: 11 / 10; }

/* 4ページ目 5コマ目はクリック可能（右縦長） */
[data-page="4"] .koma[data-koma="5"] { cursor: zoom-in; }

/* ナビ（inline onclickを廃止 → JSで付与） */
.nav-area { position: absolute; top:0; height:100%; width:50px; cursor:pointer; z-index:20; transition: background-color .3s; }
.nav-area:hover { background-color: rgba(0,0,0,.05); }
.nav-area.prev { right:0; }
.nav-area.next { left:0; }
.nav-area::after { content:''; position:absolute; top:50%; transform:translateY(-50%); width:0; height:0; border-style: solid; opacity:0; transition: opacity .3s; }
.nav-area:hover::after { opacity:.5; }
.nav-area.prev::after { right:15px; border-width:15px 0 15px 20px; border-color: transparent transparent transparent #333; }
.nav-area.next::after { left:15px; border-width:15px 20px 15px 0; border-color: transparent #333 transparent transparent; }

/* ===== ズーム＆AIボット ===== */
#bookRoot { transform-origin: var(--zoom-origin-x) var(--zoom-origin-y); }
#bookRoot.zooming-in { animation: cameraZoomIn .7s ease-out forwards; }
#bookRoot.zooming-out { animation: cameraZoomOut .7s ease-out forwards; }

@keyframes cameraZoomIn { 0% { transform: scale(1); filter: blur(0px); } 100% { transform: scale(25); filter: blur(8px); } }
@keyframes cameraZoomOut { 0% { transform: scale(25); filter: blur(8px); } 100% { transform: scale(1); filter: blur(0px); } }

.zoom-overlay { position: fixed; inset: 0; background: #000; opacity: 0; pointer-events: none; z-index: 30; transition: opacity .6s ease-out; }
.zoom-overlay.active { opacity: 1; pointer-events: auto; }

.ai-bot-wrapper { position: fixed; inset: 0; z-index: 40; display: none; opacity: 0; transition: opacity .5s ease; }
.ai-bot-wrapper.active { display: block; opacity: 1; }

.ai-bot-container { width: 100%; height: 100%; position: relative; background: #1a1a2e; }
.image-background { position: absolute; inset: 0; display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); grid-auto-rows: 120px; gap: 2px; padding: 2px; opacity: .3; overflow: hidden; }
.bg-image-cell { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 8px; position: relative; overflow: hidden; }
.bg-image-cell::before { content: '🤖'; position: absolute; inset: 0; display:flex; align-items:center; justify-content:center; font-size: 40px; opacity: .6; }
.bg-image-cell:nth-child(2n)::before { content: '💬'; }
.bg-image-cell:nth-child(3n)::before { content: '🎨'; }
.bg-image-cell:nth-child(4n)::before { content: '✨'; }
.bg-image-cell:nth-child(5n)::before { content: '🚀'; }
.bg-image-cell:nth-child(6n)::before { content: '💡'; }
.bg-image-cell:nth-child(7n)::before { content: '🌟'; }

.ai-response-area { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 80%; max-width: 800px; max-height: 60vh; background: rgba(20,20,30,.9); border-radius: 20px; padding: 30px; box-shadow: 0 20px 60px rgba(0,0,0,.3); display: none; overflow-y: auto; }
.ai-response-area.show { display: block; }
.ai-response-text { font-size: 18px; line-height: 1.6; color: #fff; word-wrap: break-word; }

.input-area { position: absolute; left: 0; right: 0; bottom: 0; background: linear-gradient(to top, rgba(26,26,46, .98), rgba(26,26,46, .9)); padding: 20px; border-top: 2px solid rgba(255,255,255,.1); }
.input-container { max-width: 800px; margin: 0 auto; display: flex; gap: 10px; }
.text-input { flex: 1; padding: 15px 20px; font-size: 16px; border: 2px solid rgba(255,255,255,.2); border-radius: 30px; background: rgba(255,255,255,.1); color: #fff; outline: none; transition: all .3s; }
.text-input::placeholder { color: rgba(255,255,255,.5); }
.text-input:focus { border-color: #667eea; background: rgba(255,255,255,.15); }
.submit-btn { padding: 15px 30px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #fff; border: none; border-radius: 30px; font-size: 16px; font-weight: 700; cursor: pointer; transition: all .3s; white-space: nowrap; }
.submit-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(102,126,234,.4); }
.submit-btn:disabled { opacity: .5; cursor: not-allowed; transform: none; }

.back-btn { position: fixed; top: 20px; right: 40px; color: white; font-size: 40px; font-weight: bold; cursor: pointer; opacity: 0; z-index: 45; transition: opacity .3s; pointer-events: none; background: rgba(0,0,0,.3); width: 50px; height: 50px; border-radius: 50%; display:flex; align-items:center; justify-content:center; }
.back-btn.visible { opacity: .85; pointer-events: auto; }
.back-btn:hover { transform: scale(1.08); background: rgba(0,0,0,.5); }

/* ===== ミニゲームモーダル ===== */
.mini-game-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center; z-index: 50; }
.mini-game-modal { position: relative; width: 92vw; height: 85vh; max-width: 1200px; background: #fff; border-radius: 12px; box-shadow: 0 20px 60px rgba(0,0,0,.4); overflow: hidden; display: flex; flex-direction: column; }
.mini-game-modal.fullscreen { width: 100vw; height: 100vh; max-width: none; border-radius: 0; background: #000; }
.mini-game-header { display: flex; align-items: center; justify-content: space-between; padding: 12px 16px; background: #1f2937; color: #fff; }
.mini-game-title { font-size: 18px; font-weight: 700; }
.mini-game-close { color: #d1d5db; font-weight: 700; font-size: 22px; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; border-radius: 9999px; cursor: pointer; }
.mini-game-close:hover { color: #fff; background: #374151; }
.mini-game-content { flex: 1 1 0; min-height: 0; }
.mini-game-modal.fullscreen .mini-game-content { position: absolute; inset: 0; z-index: 1; }
.mini-game-modal.fullscreen .mini-game-header { position: absolute; top: 8px; right: 8px; background: transparent; padding: 0; z-index: 2; }
.mini-game-modal.fullscreen .mini-game-title { display: none; }
.mini-game-iframe { width: 100%; height: 100%; border: 0; display: block; }

/* Improve visibility/usability of close button in fullscreen */
.mini-game-modal.fullscreen .mini-game-close {
  width: 44px;
  height: 44px;
  font-size: 28px;
  color: #fff;
  background: rgba(0,0,0,.35);
}
.mini-game-modal.fullscreen .mini-game-close:hover {
  background: rgba(0,0,0,.55);
}
